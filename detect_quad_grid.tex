\label{chap:detect-quad-grid}
Taking forth our length-first search algorithm, we expand fill in the details glossed over by our earlier discussion, delineating it into a formal algorithmic specification.

% Initial vertex
\newcommand{\vinit}{v_{init}}

\newcommand{\Quad}[4]{\begin{bmatrix} #1 & #2 \\ #3 & #4 \end{bmatrix}}

% Initial quad
\newcommand{\Qinit}{\Quad{n_{1,1}} {n_{1,2}} {n_{2,1}} {n_{2,2}} }

% Initial quad mirrored about y-axis
\newcommand{\Qinitmirror}{\Quad {n_{1,2}} {n_{1,1}} {n_{2,2}} {n_{2,1}}}



\section{Inputs}
\begin{enumerate}
\item A non-reflexive and symmetric vertex-vertex adjacency relation:
$$ \AdjVV: \VertexSet \mapsto \powerset{\VertexSet} $$

\item A set of visited vertices
$$ \Visited \subseteq \VertexSet $$

\item An unvisited start vertex
$$ \vinit \in \VertexSet \setminus \Visited $$
\end{enumerate}


\section{Outputs}
\begin{enumerate}
\item A structured set of vertices $\Structured \subseteq \VertexSet \setminus \Visited $ forming the extracted structured region.
The vertices $\Structured$ are structured on a 2-dimensional Cartesian lattice with $m$ rows and $n$ columns.
\end{enumerate}


%%%% PHASE 1

%% Phase 1 summary
\section{Phase 1: Grow a quad}
\label{sec:grow_a_quad}
Starting from the initial vertex $\vinit$, call it $n_{1,1}$, we would like to discover three other vertices $n_{1,2}$, $n_{2,1}$, and $n_{2,2}$ such that $\Qinit$ forms a valid quad in a structured quad region. They must satisfy the following constraints:

\begin{itemize}
\item Each of the four vertices must have exactly 4 neighbours.
\item Each of the following pairs of vertices are neighbours: $n_{1,1}$~and~$n_{1,2}$ ; $n_{1,2}$~and~$n_{2,2}$ ; $n_{2,2}$~and~$n_{2,1}$ ; $n_{2,1}$~and~$n_{1,1}$.
\item Each of the vertices must \emph{not} neighbour any vertex that has been visited thus far, apart from those vertices explicitly mentioned.
\end{itemize}

%% Phase 1 diagram

\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1cm];

										\coordinate (northleft) at (0, 2);	\coordinate (northright) at (2, 2);
	\coordinate (westup) at (-1,1);		\node (r1c1) at (0,1) {$n_{1,1}$};	\node (r1c2) at (2,1) {$n_{1,2}$};	\coordinate (eastup) at (3,1);
	\coordinate (westdown) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{2,1}$};	\node (r2c2) at (2,-1) {$n_{2,2}$};	\coordinate (eastdown) at (3,-1);
										\coordinate (southleft) at (0, -2);	\coordinate (southright) at (2, -2);

	% Horizontals
	\draw[outside] (westup) -- (r1c1);
	\draw (r1c1) -- (r1c2);
	\draw[outside] (r1c2) -- (eastup);

	\draw[outside] (westdown) -- (r2c1);
	\draw (r2c1) -- (r2c2);
	\draw[outside] (r2c2) -- (eastdown);

	% Verticals
	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1);
	\draw[outside] (r2c1) -- (southleft);

	\draw[outside] (northright) -- (r1c2);
	\draw (r1c2) -- (r2c2);
	\draw[outside] (r2c2) -- (southright);
\end{tikzpicture}

%% Phase 1 algorithm

\subsection{Algorithm}

\begin{enumerate}
\item If $\vinit$ does not have exactly 4 neighbours, that is $ \card{\AdjVV(\vinit)} \neq 4 $, return immediately with $\Structured = \varnothing$.
\item Let $ n_{1,1} = \vinit $, and let $ a, b, c \in \AdjVV(\vinit) $ be distinct vertex neighbours of $\vinit$. Consider vertices $a$ and $b$. If they do not both have exactly 4 neighbours, then they cannot form a part of a structured quad region. Return immediately with $\Structured = \varnothing$.

\item Otherwise, there are three cases:

	%%%% BEGIN THREE CASES
	\begin{enumerate}

	%% Straight line case
	\item $a$ and $b$ have exactly one neighbour in common, which must be $n_{1,1}$ by construction, expressed by:
	$$ \card{\AdjVV(a) \cap \AdjVV(b)} = 1$$
	$a, n_{1,1}, b $ are \emph{topologically} along a straight line of a structured grid, and hence cannot form a quad.
	We therefore consider $b$, $n_{1,1}$, and  $c$ instead as candidates, letting $n_{2,1} = b$ and $n_{1,2} = c$.
	\begin{tikzpicture}
		% Default action for each node
		\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

										\coordinate (northleft) at (-1,2);	\node (b) at (1,3) {$b / n_{2,1}$};	\coordinate (northright) at (3,2);
		\coordinate (west) at (-2,1);	\node (a) at (-1,1) {$a$};			\node (n11) at (1,1) {$n_{1,1}$};	\node (c) at (3,1) {$c / n_{1,2}$};	\coordinate (east) at (4,1);
										\coordinate (southleft) at (-1,0);	\coordinate (southmid) at (1,0);	\coordinate (southright) at (3,0);

		% Horizontals
		\draw[anywhere] (west) -- (a);
		\draw (a) -- (n11) -- (c);
		\draw[anywhere] (c) -- (east);

		% Verticals
		\draw[anywhere] (northleft) -- (a) -- (southleft);
		\draw (b) -- (n11);
		\draw[outside] (n11) -- (southmid);
		\draw[anywhere] (northright) -- (c) -- (southright);
	\end{tikzpicture}


	%% Angle case
	\item $a$ and $b$ have exactly two neighbours in common, one of which must be $n_{1,1}$ by construction, expressed by:
	$$ \card{\AdjVV(a) \cap \AdjVV(b)} = 2$$
	We continue with vertices $a$, $n_{1,1}$, and $b$ as candidates, letting $n_{2,1} = a$ and $n_{1,2} = b$.
	\begin{tikzpicture}
		% Default action for each node
		\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

											\coordinate (northleft) at (-1,4);		\coordinate (northright) at (1,4);
		\coordinate (westup) at (-2,3);		\node (a) at (-1,3) {$a / n_{2,1}$};	\node (d) at (1,3) {$?$};			\coordinate (eastup) at (2,3);
		\coordinate (westdown) at (-2,1);	\node (n11) at (-1,1) {$n_{1,1}$};		\node (b) at (1,1) {$b / n_{1,2}$};	\coordinate (eastdown) at (2,1);
											\coordinate (southleft) at (-1,0);		\coordinate (southright) at (1,0);



		\draw[outside] (westup) -- (a);
		\draw (a) -- (d);
		% \draw (d) -- (eastup);

		\draw[anywhere] (westdown) -- (n11);
		\draw (n11) -- (b);
		\draw[outside] (b) -- (eastdown);

		\draw[outside] (northleft) -- (a);
		\draw (a) -- (n11);
		\draw[anywhere] (n11) -- (southleft);

		% \draw (northright) -- (d);
		\draw (d) -- (b);
		\draw[outside] (b) -- (southright);

	\end{tikzpicture}


	\item $a$ and $b$ have more than two neighbours in common\footnote{Note that the set is non-empty by construction}, expressed by:
	$$ \card{\AdjVV(a) \cap \AdjVV(b)} > 2$$
	We cannot form a quad, and hence return immediately with $\Structured = \varnothing$.

	\end{enumerate}
	%%%% END THREE CASES

\item Find the common neighbours of $n_{2,1}$ and $n_{1,2}$. If these are not exactly two neighbours, return immediately with $\Structured = \varnothing$.

\item One of the two neighbours must be $n_{1,1}$ by construction. Let the other neighbour be $n_{2,2}$.

\item Let $N = \{ n_{1,1}, n_{1,2}, n_{2,1}, n_{2,2} \}$. If any vertex $n \in N$ is in $\Visited$, that is $N \cap \Visited \neq \varnothing$, then return immediately with $\Structured = \varnothing$. Otherwise add the vertices in $N$ to $\Visited$.

\item Ensure for every vertex $n \in N$ that its visited neighbours, $\AdjVV(n) \cap \Visited$, are exactly those explicitly stated above. If this is not the case, remove $N$ from $\Visited$ and return immediately with $\Structured = \varnothing$.


\item Set $\Structured = \Qinit$, and continue to the next phase.

The structured region looks as follows thus far.
\begin{tikzpicture}
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1cm];

										\coordinate (northleft) at (-1,4);	\coordinate (northright) at (1,4);
	\coordinate (westup) at (-2,3);		\node (n21) at (-1,3) {$n_{2,1}$};	\node (n22) at (1,3) {$n_{2,2}$};	\coordinate (eastup) at (2,3);
	\coordinate (westdown) at (-2,1);	\node (n11) at (-1,1) {$n_{1,1}$};	\node (n12) at (1,1) {$n_{1,2}$};	\coordinate (eastdown) at (2,1);
										\coordinate (southleft) at (-1,0);	\coordinate (southright) at (1,0);

	\draw[outside] (westup) -- (n21);
	\draw (n21) -- (n22);
	\draw[outside] (n22) -- (eastup);

	\draw[outside] (westdown) -- (n11);
	\draw (n11) -- (n12);
	\draw[outside] (n12) -- (eastdown);

	\draw[outside] (northleft) -- (n21);
	\draw (n21) -- (n11);
	\draw[outside] (n11) -- (southleft);

	\draw[outside] (northright) -- (n22);
	\draw (n22) -- (n12);
	\draw[outside] (n12) -- (southright);

\end{tikzpicture}

\end{enumerate}








%%%% Definition A

%% Definition A summary
\section{Function definition: Extend a quad}
Starting from $Q_i = \Quad {n_{1,i}} {n_{1,i+1}} {n_{2,i}} {n_{2,i+1}}$, which must be a valid quad in a structured region, we would like to find two more vertices $n_{1, i+2}$ and $n_{2,i+2}$, such that $Q_{i+1} = \Quad {n_{1,i+1}} {n_{1,i+2}} {n_{2,i+1}} {n_{2,i+2}}$ forms a valid quad in a structured quad region. They must satisfy the following constraints:

\begin{itemize}
\item Each of the vertices $n_{1, i+2}$ and $n_{2,i+2}$ must have exactly 4 neighbours.
\item Each of the following pairs of vertices are neighbours: $n_{1,i+1}$~and~$n_{1,i+2}$ ; $n_{2,i+1}$~and~$n_{2,i+2}$ ; $n_{1,i+2}$~and~$n_{2,i+2}$.
\item Each of the vertices $n_{1, i+2}$ and $n_{2,i+2}$ must \emph{not} neighbour any vertex that has been visited thus far, apart from those vertices explicitly mentioned.
\end{itemize}

%% Definition A diagram

\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

										\coordinate (northleft) at (0, 2);	\coordinate (northmid) at (2, 2);		\coordinate (northright) at (4, 2);
	\coordinate (westup) at (-1,1);		\node (r1c1) at (0,1) {$n_{1,i}$};	\node (r1c2) at (2,1) {$n_{1,i+1}$};	\node (r1c3) at (4,1) {$n_{1,i+2}$};	\coordinate (eastup) at (5,1);
	\coordinate (westdown) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{2,i}$};	\node (r2c2) at (2,-1) {$n_{2,i+1}$};	\node (r2c3) at (4,-1) {$n_{2,i+2}$};	\coordinate (eastdown) at (5,-1);
										\coordinate (southleft) at (0, -2);	\coordinate (southmid) at (2, -2);		\coordinate (southright) at (4, -2);

	% Horizontals
	\draw[outside] (westup) -- (r1c1);
	\draw (r1c1) -- (r1c2);
	\draw (r1c2) -- (r1c3);
	\draw[outside] (r1c3) -- (eastup);

	\draw[outside] (westdown) -- (r2c1);
	\draw (r2c1) -- (r2c2);
	\draw (r2c2) -- (r2c3);
	\draw[outside] (r2c3) -- (eastdown);

	% Verticals
	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1);
	\draw[outside] (r2c1) -- (southleft);

	\draw[outside] (northmid) -- (r1c2);
	\draw (r1c2) -- (r2c2);
	\draw[outside] (r2c2) -- (southmid);

	\draw[outside] (northright) -- (r1c3);
	\draw (r1c3) -- (r2c3);
	\draw[outside] (r2c3) -- (southright);
\end{tikzpicture}


%% Definition A algorithm

\subsection{Algorithm}

\begin{enumerate}
\item $n_{1,i+1}$ has 4 neighbours, which include $n_{1,i}$ and $n_{2,i+1}$. Call the remaining 2 neighbours $a$ and $b$. This is expressed by:
$$ \AdjVV(n_{1,i+1}) \setminus \{ n_{1,i} , n_{2,i+1} \} = \{ a , b \} $$

\item $n_{2,i+1}$ has 4 neighbours, which include $n_{2,i}$ and $n_{1,i+1}$. Call the remaining 2 neighbours $c$ and $d$.
$$ \AdjVV(n_{2,i+1}) \setminus \{ n_{2,i} , n_{1,i+1} \} = \{ c , d \} $$

\item Choose two vertices $n_{1,i+2} \in \{ a , b \}$ and $n_{2,i+2} \in \{ c , d \}$ such that $n_{1,i+2}$ and $n_{2,i+2}$ are neighbours, which is expressible\footnote{Or equivalently (by symmetry of $\AdjVV$) $n_{2,i+2} \in \AdjVV(n_{1,i+2})$} as:
$$n_{1,i+2} \in \AdjVV(n_{2,i+2})$$
and such that they each have exactly 4 neighbours. If no such vertices $n_{1,i+2}$ and $n_{2,i+2}$ exist, fail the procedure.


\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm, align=center, font=\small];

										\coordinate (northleft) at (0, 2);	\coordinate (northmid) at (2, 2);		\coordinate (northright) at (4, 2);
	\coordinate (westup) at (-1,3);											\node (abup) at (2,3) {$a/b$};			\coordinate (eastup) at (5,1);
	\coordinate (westmid) at (-1,1);	\node (r1c1) at (0,1) {$n_{1,i}$};	\node (r1c2) at (2,1) {$n_{1,i+1}$};	\node (r1c3) at (4,1) {$a/b =$ \\ $n_{1,i+2}$};		\coordinate (eastmid) at (5,1);
	\coordinate (westdown) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{2,i}$};	\node (r2c2) at (2,-1) {$n_{2,i+1}$};	\node (r2c3) at (4,-1) {$c/d =$ \\ $n_{2,i+2}$};	\coordinate (eastdown) at (5,-1);
	\coordinate (westlow) at (-1,-3);										\node (cdup) at (2,-3) {$c/d$};			\coordinate (eastlow) at (5,1);
										\coordinate (southleft) at (0, -2);	\coordinate (southmid) at (2, -2);		\coordinate (southright) at (4, -2);

	% Horizontals
	\draw[outside] (westmid) -- (r1c1);
	\draw (r1c1) -- (r1c2);
	\draw (r1c2) -- (r1c3);
	\draw[outside] (r1c3) -- (eastmid);

	\draw[outside] (westdown) -- (r2c1);
	\draw (r2c1) -- (r2c2);
	\draw (r2c2) -- (r2c3);
	\draw[outside] (r2c3) -- (eastdown);

	% Verticals
	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1);
	\draw[outside] (r2c1) -- (southleft);

	\draw (abup) -- (r1c2);
	\draw (r1c2) -- (r2c2);
	\draw (r2c2) -- (cdup);

	\draw[outside] (northright) -- (r1c3);
	\draw (r1c3) -- (r2c3);
	\draw[outside] (r2c3) -- (southright);
\end{tikzpicture}


\item If any of the two vertices $n_{1,i+2}$ and $n_{2,i+2}$ exists in $\Visited$, that is $\{ n_{1,i+2} , n_{2,i+2} \} \cap \Visited \neq \varnothing$, fail the procedure.
Otherwise add the two vertices to $\Visited$.

\item Ensure for every vertex $n \in \{ n_{1,i+2} , n_{2,i+2} \}$ that its visited neighbours, $\AdjVV(n) \cap \Visited$, are exactly those explicitly stated above. If this is not the case, remove $\{ n_{1,i+2} , n_{2,i+2} \}$ from $\Visited$ and fail the procedure.

\item Return the two vertices $n_{1,i+2}$ and $n_{2,i+2}$.
\end{enumerate}







%%%% PHASE 2

\section{Phase 2: Extend a row}
%% Phase 2.1 summary
``Extend a quad'' is iteratively applied, starting from $Q_1 = \Qinit$, to yield successive quads until it fails.
The resulting vertices are appended to the \emph{right} of $\Structured$ to form a single quad row in a structured quad region, or equivalently a successive pair of node rows.

%% Phase 2.1 diagram
\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

	% MIDDLE

										\coordinate (northleft) at (0, 2);	\coordinate (northright) at (2, 2);
	\coordinate (westup) at (-1,1);		\node (r1c1) at (0,1) {$n_{1,1}$};	\node (r1c2) at (2,1) {$n_{1,2}$};		\coordinate (eastup) at (3,1);
	\coordinate (westdown) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{2,1}$};	\node (r2c2) at (2,-1) {$n_{2,2}$};		\coordinate (eastdown) at (3,-1);
										\coordinate (southleft) at (0, -2);	\coordinate (southright) at (2, -2);

	% ellipses
	\coordinate (ellipsis westup) at (4,1);		\coordinate (ellipsis eastup) at (4.5,1);
	\coordinate (ellipsis westdown) at (4,-1);	\coordinate (ellipsis eastdown) at (4.5,-1);


	% RHS
											\coordinate (rhs north) at (6, 2);
	\coordinate (rhs westup) at (5,1);		\node (r1cn) at (6,1) {$n_{1,c_+}$};	\coordinate (rhs eastup) at (7,1);
	\coordinate (rhs westdown) at (5,-1);	\node (r2cn) at (6,-1) {$n_{2,c_+}$};	\coordinate (rhs eastdown) at (7,-1);
											\coordinate (rhs south) at (6, -2);



	% Horizontals
	\draw[outside] (westup) -- (r1c1);
	\draw (r1c1) -- (r1c2);
	\draw (r1c2) -- (r1c3);
	\draw (r1c3) -- (eastup);

	\draw[outside] (westdown) -- (r2c1);
	\draw (r2c1) -- (r2c2);
	\draw (r2c2) -- (r2c3);
	\draw (r2c3) -- (eastdown);

	\draw[ellipsis] (ellipsis westup) -- (ellipsis eastup);
	\draw[ellipsis] (ellipsis westdown) -- (ellipsis eastdown);


	\draw (rhs westup) -- (r1cn);
	\draw[outside] (r1cn) -- (rhs eastup);

	\draw (rhs westdown) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs eastdown);

	% Verticals
	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1);
	\draw[outside] (r2c1) -- (southleft);

	\draw[outside] (northright) -- (r1c2);
	\draw (r1c2) -- (r2c2);
	\draw[outside] (r2c2) -- (southright);

	\draw[outside] (rhs north) -- (r1cn);
	\draw (r1cn) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs south);
\end{tikzpicture}



%% Phase 2.2 summary
Next, ``Extend a quad'' is again iteratively applied, this time with $Q_1 = \Qinitmirror$, the mirror image of $Q_{init}$ about the y-axis.
The repeated application yields successive quads until the procedure fails.
The resulting vertices are appended to the \emph{left} of $\Structured$ to extend the existing quad row, or equivalently a successive pair of node rows.


%% Phase 2.2 diagram
\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

	% LHS
												\coordinate (lhs north) at (-3.5, 2);
	\coordinate (lhs westup) at (-4.5,1);		\node (r1cm) at (-3.5,1) {$n_{1,c_{\!^{\_}}}$};		\coordinate (lhs eastup) at (-2.5,1);
	\coordinate (lhs westdown) at (-4.5,-1);	\node (r2cm) at (-3.5,-1) {$n_{2,c_{\!^{\_}}}$};	\coordinate (lhs eastdown) at (-2.5,-1);
												\coordinate (lhs south) at (-3.5, -2);

	% lhs ellipses
	\coordinate (lhs ellipsis westup) at (-2,1);	\coordinate (lhs ellipsis eastup) at (-1.5,1);
	\coordinate (lhs ellipsis westdown) at (-2,-1);	\coordinate (lhs ellipsis eastdown) at (-1.5,-1);


	% MIDDLE
										\coordinate (northleft) at (0, 2);	\coordinate (northright) at (2, 2);
	\coordinate (westup) at (-1,1);		\node (r1c1) at (0,1) {$n_{1,1}$};	\node (r1c2) at (2,1) {$n_{1,2}$};		\coordinate (eastup) at (3,1);
	\coordinate (westdown) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{2,1}$};	\node (r2c2) at (2,-1) {$n_{2,2}$};		\coordinate (eastdown) at (3,-1);
										\coordinate (southleft) at (0, -2);	\coordinate (southright) at (2, -2);

	% rhs ellipses
	\coordinate (rhs ellipsis westup) at (4,1);		\coordinate (rhs ellipsis eastup) at (4.5,1);
	\coordinate (rhs ellipsis westdown) at (4,-1);	\coordinate (rhs ellipsis eastdown) at (4.5,-1);


	% RHS
											\coordinate (rhs north) at (6, 2);
	\coordinate (rhs westup) at (5,1);		\node (r1cn) at (6,1) {$n_{1,c_+}$};	\coordinate (rhs eastup) at (7,1);
	\coordinate (rhs westdown) at (5,-1);	\node (r2cn) at (6,-1) {$n_{2,c_+}$};	\coordinate (rhs eastdown) at (7,-1);
											\coordinate (rhs south) at (6, -2);



	% Horizontals
	\draw (westup) -- (r1c1);
	\draw (r1c1) -- (r1c2);
	\draw (r1c2) -- (r1c3);
	\draw (r1c3) -- (eastup);

	\draw(westdown) -- (r2c1);
	\draw (r2c1) -- (r2c2);
	\draw (r2c2) -- (r2c3);
	\draw (r2c3) -- (eastdown);


	\draw[ellipsis] (rhs ellipsis westup) -- (rhs ellipsis eastup);
	\draw[ellipsis] (rhs ellipsis westdown) -- (rhs ellipsis eastdown);

	\draw (rhs westup) -- (r1cn);
	\draw[outside] (r1cn) -- (rhs eastup);

	\draw (rhs westdown) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs eastdown);


	\draw[ellipsis] (lhs ellipsis westup) -- (lhs ellipsis eastup);
	\draw[ellipsis] (lhs ellipsis westdown) -- (lhs ellipsis eastdown);

	\draw (r1cm) -- (lhs eastup);
	\draw[outside] (lhs westup) -- (r1cm);

	\draw[outside] (lhs westdown) -- (r2cm);
	\draw (r2cm) -- (lhs eastdown);


	% Verticals
	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1);
	\draw[outside] (r2c1) -- (southleft);

	\draw[outside] (northright) -- (r1c2);
	\draw (r1c2) -- (r2c2);
	\draw[outside] (r2c2) -- (southright);


	\draw[outside] (rhs north) -- (r1cn);
	\draw (r1cn) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs south);


	\draw[outside] (lhs north) -- (r1cm);
	\draw (r1cm) -- (r2cm);
	\draw[outside] (r2cm) -- (lhs south);
\end{tikzpicture}












%% Phase 2 algorithm

\subsection{Algorithm}

\paragraph{Extend to the right}
\begin{enumerate}
\item Let $Q_{in} = Q_{init} = \Qinit$, as produced by ``Grow a quad''.
\item \label{step:extend_quad} Let $\Quad {n_{1,i}} {n_{1,i+1}} {n_{2,i}} {n_{2,i+1}}$ represent the elements of $Q_{in}$.
\item Call the procedure ``Extend a quad'' with $Q_{in}$ as input.
\item If the procedure fails, go to step~\ref{step:init_reverse}.
\item Otherwise, append the two new vertices obtained, $n_{1,i+2}$ and $n_{2,i+2}$ to the \emph{right} of $\Structured$. \\
Thus $\Structured$ will become:
	$\begin{bmatrix}
	n_{1,1} & n_{1,2} & \cdots  & n_{1,i} & n_{1,i+1} & n_{1,i+2} \\
	n_{2,1} & n_{2,2} & \cdots  & n_{2,i} & n_{2,i+1} & n_{2,i+2}
	\end{bmatrix}$

\item Set $Q_{in} = \Quad {n_{1,i+1}} {n_{1,i+2}} {n_{2,i+1}} {n_{2,i+2}}$, and continue from step~\ref{step:extend_quad}.

\end{enumerate}
\paragraph{Extend to the left}
\begin{enumerate}[resume]

% Reverse
\item \label{step:init_reverse} Let $Q_{in} = \Qinitmirror$ be the mirror image of $Q_{init}$ about the y-axis.



\item \label{step:reverse_extend_quad} Let $\Quad {n_{1,i}} {n_{1,i+1}} {n_{2,i}} {n_{2,i+1}}$ represent the elements of $Q_{in}$.
\item Call the procedure ``Extend a quad'' with $Q_{in}$ as input.
\item If the procedure fails, return immediately.
\item Otherwise, append the two new vertices obtained, $n_{1,i+2}$ and $n_{2,i+2}$ to the \emph{left} of $\Structured$. \\
Thus $\Structured$ will become:
	$\begin{bmatrix}
	n_{1,i+2} & n_{1,i+1} & n_{1,i} & \cdots & n_{1,1} & n_{1,2} & \cdots  & n_{1,c} \\
	n_{2,i+2} & n_{2,i+1} & n_{2,i} & \cdots & n_{2,1} & n_{2,2} & \cdots  & n_{2,c}
	\end{bmatrix}$
where $n_{1,c}$ and $n_{2,c}$ denote the rightmost vertices in $\Structured$.

\item Set $Q_{in} = \Quad {n_{1,i+1}} {n_{1,i+2}} {n_{2,i+1}} {n_{2,i+2}}$, and continue from step~\ref{step:reverse_extend_quad}.
\end{enumerate}





%%%% Definition B

\section{Function definition: Extend rows}
%% Definition B summary
We are given a quad row in a structured quad region, that is a pair of successive node rows, call them $r_i$ and $r_{i+1}$.
The nodes in each row are denoted by $n_{i,1} \cdots n_{i,c}$ and $n_{i+1,1} \cdots n_{i+1,c}$, respectively, where $c >= 3$ is the number of node columns.

We extend this pair of node rows $r_i$ and $r_{i+1}$ by a third node row, $r_{i+2}$, consisting of nodes $n_{i+2,1} \cdots n_{i+2,c}$. These must satisfy the following conditions:

\begin{itemize}
\item Each vertex $n_{i+2,j}$ for $j \in [1..c]$ must have exactly four neighbours.
\item Each of the pairs of vertices $n_{i+2,j}$ and $n_{i+2,j+1}$ for $j \in [1..c-1]$ are neighbours.
\item Each of the pairs of vertices $n_{i+1,j}$ and $n_{i+2,j}$ for $j \in [1..c]$ are neighbours.
\item Each vertex $n_{i+2,j}$ for $j \in [1..c]$ must not neighbour any vertex that has been visited thus far, apart from those vertices explicitly mentioned.
\end{itemize}


%% Definition B diagram
\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

	% MIDDLE

										\coordinate (northleft) at (0, 2);		\coordinate (northright) at (2, 2);
	\coordinate (westup) at (-1,1);		\node (r1c1) at (0,1) {$n_{i,1}$};		\node (r1c2) at (2,1) {$n_{i,2}$};		\coordinate (eastup) at (3,1);
	\coordinate (westmid) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{i+1,1}$};	\node (r2c2) at (2,-1) {$n_{i+1,2}$};	\coordinate (eastmid) at (3,-1);
	\coordinate (westdown) at (-1,-3);	\node (r3c1) at (0,-3) {$n_{i+2,1}$};	\node (r3c2) at (2,-3) {$n_{i+2,2}$};	\coordinate (eastdown) at (3,-3);
										\coordinate (southleft) at (0, -4);		\coordinate (southright) at (2, -4);

	% ellipses
	\coordinate (ellipsis westup) at (4,1);		\coordinate (ellipsis eastup) at (4.5,1);
	\coordinate (ellipsis westmid) at (4,-1);	\coordinate (ellipsis eastmid) at (4.5,-1);
	\coordinate (ellipsis westdown) at (4,-3);	\coordinate (ellipsis eastdown) at (4.5,-3);


	% RHS
											\coordinate (rhs north) at (6, 2);
	\coordinate (rhs westup) at (5,1);		\node (r1cn) at (6,1) {$n_{i,c}$};		\coordinate (rhs eastup) at (7,1);
	\coordinate (rhs westmid) at (5,-1);	\node (r2cn) at (6,-1) {$n_{i+1,c}$};	\coordinate (rhs eastmid) at (7,-1);
	\coordinate (rhs westdown) at (5,-3);	\node (r3cn) at (6,-3) {$n_{i+2,c}$};	\coordinate (rhs eastdown) at (7,-3);
											\coordinate (rhs south) at (6, -4);

	% Horizontals
	\draw[outside] (westup) -- (r1c1);
	\draw (r1c1) -- (r1c2);
	\draw (r1c2) -- (eastup);

	\draw[outside] (westmid) -- (r2c1);
	\draw (r2c1) -- (r2c2);
	\draw (r2c2) -- (eastmid);

	\draw[outside] (westdown) -- (r3c1);
	\draw (r3c1) -- (r3c2);
	\draw (r3c2) -- (eastdown);


	\draw[ellipsis] (ellipsis westup) -- (ellipsis eastup);
	\draw[ellipsis] (ellipsis westmid) -- (ellipsis eastmid);
	\draw[ellipsis] (ellipsis westdown) -- (ellipsis eastdown);


	\draw (rhs westup) -- (r1cn);
	\draw[outside] (r1cn) -- (rhs eastup);

	\draw (rhs westmid) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs eastmid);

	\draw (rhs westdown) -- (r3cn);
	\draw[outside] (r3cn) -- (rhs eastdown);

	% Verticals
	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1);
	\draw (r2c1) -- (r3c1);
	\draw[outside] (r3c1) -- (southleft);

	\draw[outside] (northright) -- (r1c2);
	\draw (r1c2) -- (r2c2);
	\draw (r2c2) -- (r3c2);
	\draw[outside] (r3c2) -- (southright);

	\draw[outside] (rhs north) -- (r1cn);
	\draw (r1cn) -- (r2cn);
	\draw (r2cn) -- (r3cn);
	\draw[outside] (r3cn) -- (rhs south);
\end{tikzpicture}



%% Definition B algorithm

\subsection{Algorithm}

\begin{enumerate}
\item Let $n_{i+2,2}$ be the unique vertex in the set $\AdjVV(n_{i+1,2}) \setminus \{ n_{i+1,1} , n_{i+1,3} , n_{i,2} \} $.
\item Let $N = \AdjVV(n_{i+1,1}) \cap \AdjVV(n_{i+2,2})$ be the common neighbours of $n_{i+1,1}$ and $n_{i+2,2}$.
If the number of common neighbours $\card{N}$ is not exactly two, fail the procedure.
\item We know that $n_{i+1,2} \in N$ by construction. Let $n_{i+2,1}$ be the other vertex in $N$.
\item If either of $n_{i+2,1}$ or $n_{i+2,2}$ is in $\Visited$, fail the procedure. Otherwise add the two vertices to $\Visited$.
\item Ensure that the visited neighbours of $n_{i+2,1}$ and $n_{i+2,2}$ are exactly as specified,
that is $n_{i+2,1} \cap \Visited = \{ n_{i+2,2} , n_{i+1,1} \}$ and $n_{i+2,2} \cap \Visited = \{ n_{i+2,1} , n_{i+1,2} \}$.
If this is not the case, remove $n_{i+2,1}$ and $n_{i+2,2}$ from $\Visited$ and fail the procedure.





\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

	% MIDDLE

										\coordinate (northleft) at (0, 2);		\coordinate (northmid) at (2, 2);		\coordinate (northright) at (4, 2);
	\coordinate (westup) at (-1,1);		\node (r1c1) at (0,1) {$n_{i,1}$};		\node (r1c2) at (2,1) {$n_{i,2}$};		\node (r1c3) at (4,1) {$n_{i,3}$};		\coordinate (eastup) at (5,1);
	\coordinate (westmid) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{i+1,1}$};	\node (r2c2) at (2,-1) {$n_{i+1,2}$};	\node (r2c3) at (4,-1) {$n_{i+1,3}$};	\coordinate (eastmid) at (5,-1);
	\coordinate (westdown) at (-1,-3);	\node (r3c1) at (0,-3) {$n_{i+2,1}$};	\node (r3c2) at (2,-3) {$n_{i+2,2}$};											\coordinate (eastdown) at (3,-3);
										\coordinate (southleft) at (0, -4);		\coordinate (southmid) at (2, -4);		\coordinate (southright) at (4, -2);

	% ellipses
	\coordinate (ellipsis westup) at (5,1);		\coordinate (ellipsis eastup) at (5.5,1);
	\coordinate (ellipsis westdown) at (5,-1);	\coordinate (ellipsis eastdown) at (5.5,-1);


	% RHS
											\coordinate (rhs north) at (7, 2);
	\coordinate (rhs westup) at (6,1);		\node (r1cn) at (7,1) {$n_{i,c}$};		\coordinate (rhs eastup) at (8,1);
	\coordinate (rhs westmid) at (6,-1);	\node (r2cn) at (7,-1) {$n_{i+1,c}$};	\coordinate (rhs eastmid) at (8,-1);
											\coordinate (rhs south) at (7, -2);

	% Horizontals
	\draw[outside] (westup) -- (r1c1);
	\draw (r1c1) -- (r1c2) -- (r1c3) -- (eastup);

	\draw[outside] (westmid) -- (r2c1);
	\draw (r2c1) -- (r2c2) -- (r2c3) -- (eastmid);

	\draw[outside] (westdown) -- (r3c1);
	\draw (r3c1) -- (r3c2);
	\draw[outside] (r3c2) -- (eastdown);


	\draw[ellipsis] (ellipsis westup) -- (ellipsis eastup);
	\draw[ellipsis] (ellipsis westdown) -- (ellipsis eastdown);


	\draw (rhs westup) -- (r1cn);
	\draw[outside] (r1cn) -- (rhs eastup);

	\draw (rhs westmid) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs eastmid);


	% Verticals
	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1);
	\draw (r2c1) -- (r3c1);
	\draw[outside] (r3c1) -- (southleft);

	\draw[outside] (northmid) -- (r1c2);
	\draw (r1c2) -- (r2c2);
	\draw (r2c2) -- (r3c2);
	\draw[outside] (r3c2) -- (southmid);

	\draw[outside] (northright) -- (r1c3);
	\draw (r1c3) -- (r2c3);
	\draw[outside] (r2c3) -- (southright);


	\draw[outside] (rhs north) -- (r1cn);
	\draw (r1cn) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs south);
\end{tikzpicture}




\item For each column\footnote{Possibly none if $c = 3$} $j \in [3..c-1]$:
	\begin{enumerate}
	\item Let $n_{i+2,j}$ be the unique vertex in the set $\AdjVV(n_{i+1,j}) \setminus \{ n_{i+1,j-1} , n_{i+1,j+1} , n_{i,j} \}$.
	\item If $n_{i+2,j} \in \Visited$, remove all vertices in $r_{i+2}$ from $\Visited$, that is $\{ n_{i+2,k} \mid k \in [1..j] \}$ and fail the procedure.
	Otherwise, add $n_{i+2,j}$ $\Visited$.
	\item Ensure that visited neighbours of $n_{i+2,j}$ are exactly $n_{i+2,j-1}$, $n_{i+1,j}$.
	If this is not the case remove vertices $\{ n_{i+2,k} \mid k \in [1..j] \}$ from $\Visited$ and fail the procedure.
	\end{enumerate}




% Foreach j diagram
\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.4cm, font=\small];

	% LHS
												\coordinate (lhs north) at (-3.5, 2);
	\coordinate (lhs westup) at (-4.5,1);		\node (r1c0) at (-3.5,1) {$n_{i,1}$};		\coordinate (lhs eastup) at (-2.5,1);
	\coordinate (lhs westmid) at (-4.5,-1);		\node (r2c0) at (-3.5,-1) {$n_{i+1,1}$};	\coordinate (lhs eastmid) at (-2.5,-1);
	\coordinate (lhs westdown) at (-4.5,-3);	\node (r3c0) at (-3.5,-3) {$n_{i+2,1}$};	\coordinate (lhs eastdown) at (-2.5,-3);
												\coordinate (lhs south) at (-3.5, -4);

	% LHS ellipses
	\coordinate (lhs ellipsis westup) at (-2,1);	\coordinate (lhs ellipsis eastup) at (-1.5,1);
	\coordinate (lhs ellipsis westmid) at (-2,-1);	\coordinate (lhs ellipsis eastmid) at (-1.5,-1);
	\coordinate (lhs ellipsis westdown) at (-2,-3);	\coordinate (lhs ellipsis eastdown) at (-1.5,-3);


	% MIDDLE
										\coordinate (northleft) at (0, 2);		\coordinate (northmid) at (2, 2);		\coordinate (northright) at (4, 2);
	\coordinate (westup) at (-1,1);		\node (r1c1) at (0,1) {$n_{i,j-1}$};	\node (r1c2) at (2,1) {$n_{i,j}$};		\node (r1c3) at (4,1) {$n_{i,j+1}$};	\coordinate (eastup) at (5,1);
	\coordinate (westmid) at (-1,-1);	\node (r2c1) at (0,-1) {$n_{i+1,j-1}$};	\node (r2c2) at (2,-1) {$n_{i+1,j}$};	\node (r2c3) at (4,-1) {$n_{i+1,j+1}$};	\coordinate (eastmid) at (5,-1);
	\coordinate (westdown) at (-1,-3);	\node (r3c1) at (0,-3) {$n_{i+2,j-1}$};	\node (r3c2) at (2,-3) {$n_{i+2,j}$};											\coordinate (eastdown) at (3,-3);
										\coordinate (southleft) at (0, -4);		\coordinate (southmid) at (2, -4);		\coordinate (southright) at (4, -2);

	% rhs ellipses
	\coordinate (rhs ellipsis westup) at (5,1);		\coordinate (rhs ellipsis eastup) at (5.5,1);
	\coordinate (rhs ellipsis westdown) at (5,-1);	\coordinate (rhs ellipsis eastdown) at (5.5,-1);


	% RHS
											\coordinate (rhs north) at (7, 2);
	\coordinate (rhs westup) at (6,1);		\node (r1cn) at (7,1) {$n_{i,c}$};		\coordinate (rhs eastup) at (8,1);
	\coordinate (rhs westmid) at (6,-1);	\node (r2cn) at (7,-1) {$n_{i+1,c}$};	\coordinate (rhs eastmid) at (8,-1);
											\coordinate (rhs south) at (7, -2);

	% Horizontals
	\draw[outside] (lhs westup) -- (r1c0);
	\draw (r1c0) -- (lhs eastup);

	\draw[outside] (lhs westmid) -- (r2c0);
	\draw (r2c0) -- (lhs eastmid);

	\draw[outside] (lhs westdown) -- (r3c0);
	\draw (r3c0) -- (lhs eastdown);


	\draw (westup) -- (r1c1) -- (r1c2) -- (r1c3) -- (eastup);

	\draw (westmid) -- (r2c1) -- (r2c2) -- (r2c3) -- (eastmid);

	\draw (westdown) -- (r3c1) -- (r3c2);
	\draw[outside] (r3c2) -- (eastdown);


	\draw[ellipsis] (lhs ellipsis westup) -- (lhs ellipsis eastup);
	\draw[ellipsis] (lhs ellipsis westmid) -- (lhs ellipsis eastmid);
	\draw[ellipsis] (lhs ellipsis westdown) -- (lhs ellipsis eastdown);

	\draw[ellipsis] (rhs ellipsis westup) -- (rhs ellipsis eastup);
	\draw[ellipsis] (rhs ellipsis westdown) -- (rhs ellipsis eastdown);


	\draw (rhs westup) -- (r1cn);
	\draw[outside] (r1cn) -- (rhs eastup);

	\draw (rhs westmid) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs eastmid);


	% Verticals
	\draw[outside] (lhs north) -- (r1c0);
	\draw (r1c0) -- (r2c0) -- (r3c0);
	\draw[outside] (r3c0) -- (lhs south);


	\draw[outside] (northleft) -- (r1c1);
	\draw (r1c1) -- (r2c1) -- (r3c1);
	\draw[outside] (r3c1) -- (southleft);

	\draw[outside] (northmid) -- (r1c2);
	\draw (r1c2) -- (r2c2) -- (r3c2);
	\draw[outside] (r3c2) -- (southmid);

	\draw[outside] (northright) -- (r1c3);
	\draw (r1c3) -- (r2c3);
	\draw[outside] (r2c3) -- (southright);


	\draw[outside] (rhs north) -- (r1cn);
	\draw (r1cn) -- (r2cn);
	\draw[outside] (r2cn) -- (rhs south);
\end{tikzpicture}







\item Consider $\AdjVV(n_{i+2,c-1}) \cap \AdjVV(n_{i+1,c})$, the common neighbours of $n_{i+2,c-1}$ and $n_{i+1,c}$.
If these are not exactly two neighbours, remove vertices $\{ n_{i+2,k} \mid k \in [1..c-1] \}$ from $\Visited$ and fail the procedure.
\item One of the two neighbours must be $n_{i+1,c}$ by construction. Let $n_{i+2,c}$ denote the other neighbour.
\item If $n_{i+2,c} \in \Visited$, remove vertices $\{ n_{i+2,k} \mid k \in [1..c-1] \}$ from $\Visited$ and fail the procedure.
Otherwise, add $n_{i+2,c}$ to $\Visited$.
\item Ensure that the visited neighbours of $n_{i+2,c}$ are exactly $\{ n_{i+2,c-1} , n_{i+1,c} \}$,
that is $\AdjVV(n_{i+2,c}) \cap \Visited = \{ n_{i+2,c-1} , n_{i+1,c} \}$. If this is not the case remove vertices $\{ n_{i+2,k} \mid k \in [1..c] \}$ from $\Visited$ and fail the procedure.




% lastnode diagram
\begin{tikzpicture}[scale=1]
	% Default action for each node
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.4cm, font=\small];

	% LHS
												\coordinate (lhs north) at (-1.5, 2);
	\coordinate (lhs westup) at (-2.5,1);		\node (r1c0) at (-1.5,1) {$n_{i,1}$};		\coordinate (lhs eastup) at (-0.5,1);
	\coordinate (lhs westmid) at (-2.5,-1);		\node (r2c0) at (-1.5,-1) {$n_{i+1,1}$};	\coordinate (lhs eastmid) at (-0.5,-1);
	\coordinate (lhs westdown) at (-2.5,-3);	\node (r3c0) at (-1.5,-3) {$n_{i+2,1}$};	\coordinate (lhs eastdown) at (-0.5,-3);
												\coordinate (lhs south) at (-1.5, -4);

	% LHS ellipses
	\coordinate (lhs ellipsis westup) at (0,1);		\coordinate (lhs ellipsis eastup) at (0.5,1);
	\coordinate (lhs ellipsis westmid) at (0,-1);	\coordinate (lhs ellipsis eastmid) at (0.5,-1);
	\coordinate (lhs ellipsis westdown) at (0,-3);	\coordinate (lhs ellipsis eastdown) at (0.5,-3);


	% MIDDLE
										\coordinate (northmid) at (2, 2);		\coordinate (northright) at (4, 2);
	\coordinate (westup) at (1,1);		\node (r1c2) at (2,1) {$n_{i,c-1}$};	\node (r1c3) at (4,1) {$n_{i,c}$};		\coordinate (eastup) at (5,1);
	\coordinate (westmid) at (1,-1);	\node (r2c2) at (2,-1) {$n_{i+1,c-1}$};	\node (r2c3) at (4,-1) {$n_{i+1,c}$};	\coordinate (eastmid) at (5,-1);
	\coordinate (westdown) at (1,-3);	\node (r3c2) at (2,-3) {$n_{i+2,c-1}$};	\node (r3c3) at (4,-3) {$n_{i+2,c}$};	\coordinate (eastdown) at (5,-3);
										\coordinate (southmid) at (2, -4);		\coordinate (southright) at (4, -4);




	% Horizontals
	\draw[outside] (lhs westup) -- (r1c0);
	\draw (r1c0) -- (lhs eastup);

	\draw[outside] (lhs westmid) -- (r2c0);
	\draw (r2c0) -- (lhs eastmid);

	\draw[outside] (lhs westdown) -- (r3c0);
	\draw (r3c0) -- (lhs eastdown);


	\draw (westup) -- (r1c2) -- (r1c3);
	\draw[outside] (r1c3) -- (eastup);

	\draw (westmid) -- (r2c2) -- (r2c3);
	\draw[outside] (r2c3) -- (eastmid);

	\draw (westdown) -- (r3c2) -- (r3c3);
	\draw[outside] (r3c3) -- (eastdown);


	\draw[ellipsis] (lhs ellipsis westup) -- (lhs ellipsis eastup);
	\draw[ellipsis] (lhs ellipsis westmid) -- (lhs ellipsis eastmid);
	\draw[ellipsis] (lhs ellipsis westdown) -- (lhs ellipsis eastdown);


	% Verticals
	\draw[outside] (lhs north) -- (r1c0);
	\draw (r1c0) -- (r2c0) -- (r3c0);
	\draw[outside] (r3c0) -- (lhs south);

	\draw[outside] (northmid) -- (r1c2);
	\draw (r1c2) -- (r2c2) -- (r3c2);
	\draw[outside] (r3c2) -- (southmid);

	\draw[outside] (northright) -- (r1c3);
	\draw (r1c3) -- (r2c3) -- (r3c3);
	\draw[outside] (r3c3) -- (southright);

\end{tikzpicture}

\item Return the vertices of node row $r_{i+2}$, that is $n_{i+2,1} \cdots n_{i+2,c}$.
\end{enumerate}





%%%% PHASE 3

\section{Phase 3: Extend rows}
%% Phase 3.1 summary
``Extend a row'' is iteratively applied, starting from $r_1 = n_{1,1} \cdots n_{1,c}$ and $r_2 = n_{2,1} \cdots n_{2,c}$, to yield successive rows until it fails.
The resulting rows are appended \emph{below} $\Structured$.


%% Phase 3.1 diagram
\begin{tikzpicture}
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

	% First rows
	\drawellipsiscol{num=2, rowoffset=6, coloffset=7.5}
	\drawgrid{rows=2, cols=3, rowoffset=6,
		labeler=\plainlabelnode, labelerA=0, labelerB=0,
		southborder=structured, eastborder=structured}
	\drawgrid{rows=2, cols=1, rowoffset=6, coloffset=8,
		labeler=\varcollabelnode, labelerA=0, labelerB=0, labelerC=c,
		southborder=structured, westborder=structured}

	% Bottom horizontal ellipsis
	\drawellipsisrow{num=3, rowoffset=0.5}
	\drawellipsisrow{num=1, rowoffset=0.5, coloffset=8}

	% Last row
	\drawellipsiscol{num=1, rowoffset=0, coloffset=7.5}
	\drawgrid{rows=1, cols=3, rowoffset=0,
		labeler=\varrowlabelnode, labelerA=0, labelerB=0, labelerC=r_+,
		northborder=structured, eastborder=structured}
	\drawgrid{rows=1, cols=1, rowoffset=0, coloffset=8,
		labeler=\varlabelnode, labelerA=0, labelerB=0, labelerC=r_+, labelerD=c,
		northborder=structured, westborder=structured}
\end{tikzpicture}




%% Phase 3.2 summary
``Extend a row'' is iteratively applied, starting from the mirror image of the initial rows about the x-axis, that is $r_1 = n_{2,1} \cdots n_{2,c}$ and $r_2 = n_{1,1} \cdots n_{1,c}$, to yield successive rows until it fails.
The resulting rows are appended \emph{above} $\Structured$.

%% Phase 3.2 diagram
\begin{tikzpicture}
	\tikzstyle{every node}=[draw, shape=circle, minimum size=1.3cm];

	% First first rows
	\drawellipsiscol{num=1, rowoffset=10, coloffset=7.5}
	\drawgrid{rows=1, cols=3, rowoffset=10,
		labeler=\varrowlabelnode, labelerA=0, labelerB=0, labelerC=r_{\!^{\_}},
		southborder=structured, eastborder=structured}
	\drawgrid{rows=1, cols=1, rowoffset=10, coloffset=8,
		labeler=\varlabelnode, labelerA=0, labelerB=0, labelerC=r_{\!^{\_}}, labelerD=c,
		southborder=structured, westborder=structured}

	% Top horizontal ellipsis
	\drawellipsisrow{num=3, rowoffset=6.5}
	\drawellipsisrow{num=1, rowoffset=6.5, coloffset=8}

	% First rows
	\drawellipsiscol{num=2, rowoffset=6, coloffset=7.5}
	\drawgrid{rows=2, cols=3, rowoffset=6,
		labeler=\plainlabelnode, labelerA=0, labelerB=0,
		southborder=structured, eastborder=structured, northborder=structured}
	\drawgrid{rows=2, cols=1, rowoffset=6, coloffset=8,
		labeler=\varcollabelnode, labelerA=0, labelerB=0, labelerC=c,
		southborder=structured, westborder=structured, northborder=structured}

	% Bottom horizontal ellipsis
	\drawellipsisrow{num=3, rowoffset=0.5}
	\drawellipsisrow{num=1, rowoffset=0.5, coloffset=8}

	% Last row
	\drawellipsiscol{num=1, rowoffset=0, coloffset=7.5}
	\drawgrid{rows=1, cols=3, rowoffset=0,
		labeler=\varrowlabelnode, labelerA=0, labelerB=0, labelerC=r_+,
		northborder=structured, eastborder=structured}
	\drawgrid{rows=1, cols=1, rowoffset=0, coloffset=8,
		labeler=\varlabelnode, labelerA=0, labelerB=0, labelerC=r_+, labelerD=c,
		northborder=structured, westborder=structured}
\end{tikzpicture}


%% Phase 3 algorithm

\subsection{Algorithm}

\paragraph{Extend below}
\begin{enumerate}
\item Let $r_a = n_{1,1} \cdots n_{1,c}$ and $r_b = n_{2,1} \cdots n_{2,c}$ be the first two structured node rows.
\item \label{step:extend_row} Let $n_{i,1} \cdots n_{i,c}$ and $n_{i+1,1} \cdots n_{i+1,c}$ represent the respective elements of $r_a$ and $r_b$.
\item Call the procedure ``Extend a row'' with $r_a$ and $r_b$ as inputs.
\item If the procedure fails, go to step~\ref{step:init_reverse_row}.
\item Otherwise, append the new row obtained $r_{new} = n_{i+2,1} \cdots n_{i+2,c}$ \emph{below} $\Structured$.\\
Thus $\Structured$ will become:
$\begin{bmatrix}
	n_{1,1}   & n_{1,2}   & \cdots  & n_{1,c}   \\
	n_{2,1}   & n_{2,2}   & \cdots  & n_{2,c}   \\
	\vdots    & \vdots    &         & \vdots    \\
	n_{i,1}   & n_{i,2}   & \cdots  & n_{i,c}   \\
	n_{i+1,1} & n_{i+1,2} & \cdots  & n_{i+1,c} \\
	n_{i+2,1} & n_{i+2,2} & \cdots  & n_{i+2,c}
	\end{bmatrix}$
\item Set $r_a = n_{i+1,1} \cdots n_{i+1,c}$ and $r_b = n_{i+2,1} \cdots n_{i+2,c}$, and continue from step~\ref{step:extend_row}.
\end{enumerate}

\paragraph{Extend above}
\begin{enumerate}[resume]
\item \label{step:init_reverse_row} Let $r_a = n_{2,1} \cdots n_{2,c}$ and $r_b = n_{1,1} \cdots n_{1,c}$ be the first two structured node rows, the other way around.
\item \label{step:reverse_extend_row} Let $n_{i,1} \cdots n_{i,c}$ and $n_{i+1,1} \cdots n_{i+1,c}$ represent the respective elements of $r_a$ and $r_b$.
\item Call the procedure ``Extend a row'' with $r_a$ and $r_b$ as inputs.
\item If the procedure fails, return immediately.
\item Otherwise, append the new row obtained $r_{new} = n_{i+2,1} \cdots n_{i+2,c}$ \emph{above} $\Structured$.\\
Thus $\Structured$ will become:
$\begin{bmatrix}
	n_{i+2,1} & n_{i+2,2} & \cdots  & n_{i+2,c} \\
	n_{i+1,1} & n_{i+1,2} & \cdots  & n_{i+1,c} \\
	n_{i,1}   & n_{i,2}   & \cdots  & n_{i,c}   \\
	\vdots    & \vdots    &         & \vdots    \\
	n_{1,1}   & n_{1,2}   & \cdots  & n_{1,c}   \\
	n_{2,1}   & n_{2,2}   & \cdots  & n_{2,c}   \\
	\vdots    & \vdots    &         & \vdots    \\
	n_{r_+,1} & n_{r_+,2} & \cdots  & n_{r_+,c}
	\end{bmatrix}$
\item Set $r_a = n_{i+1,1} \cdots n_{i+1,c}$ and $r_b = n_{i+2,1} \cdots n_{i+2,c}$, and continue from step~\ref{step:reverse_extend_row}.
\end{enumerate}

\section{Chapter summary}
In this chapter we refined our sketch of the length-first search algorithm into a more precise form.
% TODO
 % Into a precise form more amenable for complexity analysis. We also discuss the algorithmic complexity of the algorithm, and find it to be linear in the number of vertices.